<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<title>MonkOS: /home/brett/c/monk/kernel/device/keyboard.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MonkOS
   &#160;<span id="projectnumber">v0.1</span>
   </div>
   <div id="projectbrief">A simple 64-bit operating system (x86_64)</div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('keyboard_8c_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">keyboard.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="keyboard_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">//============================================================================</span><span class="comment"></span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">/// @file       keyboard.c</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">/// @brief      Keyboard input routines.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"></span><span class="comment">//</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// Copyright 2016 Brett Vickers.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// Use of this source code is governed by a BSD-style license that can</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// be found in the MonkOS LICENSE file.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//============================================================================</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="core_8h.html">core.h</a>&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="string_8h.html">libc/string.h</a>&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="cpu_8h.html">kernel/x86/cpu.h</a>&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="keyboard_8h.html">kernel/device/keyboard.h</a>&gt;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="interrupt_8h.html">kernel/interrupt/interrupt.h</a>&gt;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// Keyboard I/O ports</span></div><div class="line"><a name="l00017"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a75d086fb1bfdedee4b3084000b7340aa">   17</a></span>&#160;<span class="preprocessor">#define KB_PORT_DATA  0x60       </span><span class="comment">///&lt; Keyboard I/O data port.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">// Other constants</span></div><div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a8d84f7f555ffa92f34268350c4ed1387">   20</a></span>&#160;<span class="preprocessor">#define MAX_BUFSIZ    32         </span><span class="comment">///&lt; Keyboard input buffer size.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">// Key code abbreviations, used to set up the default scan map table below.</span></div><div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a0943e7097f3f59fdf4ce00ead17bfab5">   23</a></span>&#160;<span class="preprocessor">#define BSP           KEY_BACKSPACE</span></div><div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="keyboard_8c.html#ad58a1fbfc85c7e4790fc55e654f50221">   24</a></span>&#160;<span class="preprocessor">#define TAB           KEY_TAB</span></div><div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a9dba8e1e667dc0da64c02c196b750a7a">   25</a></span>&#160;<span class="preprocessor">#define ENT           KEY_ENTER</span></div><div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a4af1b6159e447ba72652bb7fcdfa726e">   26</a></span>&#160;<span class="preprocessor">#define ESC           KEY_ESCAPE</span></div><div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="keyboard_8c.html#ac16e9c5c93955f2c396aaa9829b72323">   27</a></span>&#160;<span class="preprocessor">#define CTL           KEY_CTRL</span></div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a3cbd3b51b8f703d3e48999f01a764541">   28</a></span>&#160;<span class="preprocessor">#define SHF           KEY_SHIFT</span></div><div class="line"><a name="l00029"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a9d8a33b1a8b82b9913a0ba70438d45be">   29</a></span>&#160;<span class="preprocessor">#define ALT           KEY_ALT</span></div><div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a46eb462e05a3197e84ff95d874d67f34">   30</a></span>&#160;<span class="preprocessor">#define PSC           KEY_PRTSCR</span></div><div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a4b355291fe6b8ba8e167ab0faa862e45">   31</a></span>&#160;<span class="preprocessor">#define CLK           KEY_CAPSLOCK</span></div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="keyboard_8c.html#af73f5decf6cbc5a244cec630cf0cc292">   32</a></span>&#160;<span class="preprocessor">#define NLK           KEY_NUMLOCK</span></div><div class="line"><a name="l00033"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a6339220d7a81d2c89a391ce5494ca2e3">   33</a></span>&#160;<span class="preprocessor">#define SLK           KEY_SCRLOCK</span></div><div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="keyboard_8c.html#aae051115a74a6f9544925894a8d00891">   34</a></span>&#160;<span class="preprocessor">#define KIN           KEY_INSERT</span></div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a9fdd8498502d4c5d45ccf54eb80a2254">   35</a></span>&#160;<span class="preprocessor">#define KEN           KEY_END</span></div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a5d31dc96753cf56b7242a24a6ce84952">   36</a></span>&#160;<span class="preprocessor">#define KDN           KEY_DOWN</span></div><div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a7b182df4413aa6cf1967afa0665a6db0">   37</a></span>&#160;<span class="preprocessor">#define KPD           KEY_PGDN</span></div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="keyboard_8c.html#ae94ef7c80cd78acb2497a7bd6e4059d5">   38</a></span>&#160;<span class="preprocessor">#define KLT           KEY_LEFT</span></div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a43671298f16eb7f8bcdfa53d87142ac2">   39</a></span>&#160;<span class="preprocessor">#define KCT           KEY_CENTER</span></div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="keyboard_8c.html#ace5e58d807b4e952987cfac5422be7a4">   40</a></span>&#160;<span class="preprocessor">#define KRT           KEY_RIGHT</span></div><div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a1f4ff2a884f2f41f545230116a6442ee">   41</a></span>&#160;<span class="preprocessor">#define KHM           KEY_HOME</span></div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="keyboard_8c.html#adce94db96a966370f2e48f90c96fb24a">   42</a></span>&#160;<span class="preprocessor">#define KUP           KEY_UP</span></div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a1276354d08e936827e42bbb7db1fe34d">   43</a></span>&#160;<span class="preprocessor">#define KPU           KEY_PGUP</span></div><div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a80b2763f63f3068e81a5933d44fbb6af">   44</a></span>&#160;<span class="preprocessor">#define KDL           KEY_DEL</span></div><div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="keyboard_8c.html#aa77f0542f09ee7a9c12712dace9bfa80">   45</a></span>&#160;<span class="preprocessor">#define KMI           KEY_MINUS</span></div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="keyboard_8c.html#acfe552a3625b01348ebdde65192f69f0">   46</a></span>&#160;<span class="preprocessor">#define KPL           KEY_PLUS</span></div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a435f756795e3454fe3e181d5434515ca">   47</a></span>&#160;<span class="preprocessor">#define F_1           KEY_F1</span></div><div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="keyboard_8c.html#af0d28d590ed60c797d6caec15ceccdd0">   48</a></span>&#160;<span class="preprocessor">#define F_2           KEY_F2</span></div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a8f409cf3682b3db2d1d48ae947e8ca71">   49</a></span>&#160;<span class="preprocessor">#define F_3           KEY_F3</span></div><div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a7db10cdc8b1ff4a1880528ac1cb12686">   50</a></span>&#160;<span class="preprocessor">#define F_4           KEY_F4</span></div><div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="keyboard_8c.html#adc62e34d3d434791472398628ae91f16">   51</a></span>&#160;<span class="preprocessor">#define F_5           KEY_F5</span></div><div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="keyboard_8c.html#ae2c99833f0529c30cacd5229aad81125">   52</a></span>&#160;<span class="preprocessor">#define F_6           KEY_F6</span></div><div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a177007ee38c6d2ad8a462e4296b56244">   53</a></span>&#160;<span class="preprocessor">#define F_7           KEY_F7</span></div><div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a746a5dc770f29d218377bf82d53a405d">   54</a></span>&#160;<span class="preprocessor">#define F_8           KEY_F8</span></div><div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a595ccf4674f4cea3175b56efedb26d33">   55</a></span>&#160;<span class="preprocessor">#define F_9           KEY_F9</span></div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a9ba8300113c516255f356f9bd121c518">   56</a></span>&#160;<span class="preprocessor">#define F10           KEY_F10</span></div><div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a99f005ac9af7ee84e760e99b4b63b702">   57</a></span>&#160;<span class="preprocessor">#define F11           KEY_F11</span></div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="keyboard_8c.html#ad482c9af265b4abca9a472209d2273dc">   58</a></span>&#160;<span class="preprocessor">#define F12           KEY_F12</span></div><div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="keyboard_8c.html#ab380112d877adff3c3ccc7877a01be36">   59</a></span>&#160;<span class="preprocessor">#define SES           KEY_SCANESC</span></div><div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">   60</a></span>&#160;<span class="preprocessor">#define INV           KEY_INVALID</span></div><div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a9b88d338f018c2e5801f9b179fed5c88">   61</a></span>&#160;<span class="preprocessor">#define APO           &#39;\&#39;&#39;</span></div><div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a403a5d3d3c1422d27a56e5153f16c240">   62</a></span>&#160;<span class="preprocessor">#define BSL           &#39;\\&#39;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">/// US English PSC/2 keyboard scan map (default setting)</span></div><div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a3fe10b73f8efc167fb2d42ae57659226">   65</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> <span class="keyword">const</span> keylayout_t <a class="code" href="keyboard_8c.html#a3fe10b73f8efc167fb2d42ae57659226">ps2_layout</a> =</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    .shifted =</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a4af1b6159e447ba72652bb7fcdfa726e">ESC</a>, <span class="charliteral">&#39;!&#39;</span>, <span class="charliteral">&#39;@&#39;</span>, <span class="charliteral">&#39;#&#39;</span>, <span class="charliteral">&#39;$&#39;</span>, <span class="charliteral">&#39;%&#39;</span>, <span class="charliteral">&#39;^&#39;</span>,</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="charliteral">&#39;&amp;&#39;</span>, <span class="charliteral">&#39;*&#39;</span>, <span class="charliteral">&#39;(&#39;</span>, <span class="charliteral">&#39;)&#39;</span>, <span class="charliteral">&#39;_&#39;</span>, <span class="charliteral">&#39;+&#39;</span>, <a class="code" href="keyboard_8c.html#a0943e7097f3f59fdf4ce00ead17bfab5">BSP</a>, <a class="code" href="keyboard_8c.html#ad58a1fbfc85c7e4790fc55e654f50221">TAB</a>, <span class="comment">// 0</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <span class="charliteral">&#39;Q&#39;</span>, <span class="charliteral">&#39;W&#39;</span>, <span class="charliteral">&#39;E&#39;</span>, <span class="charliteral">&#39;R&#39;</span>, <span class="charliteral">&#39;T&#39;</span>, <span class="charliteral">&#39;Y&#39;</span>, <span class="charliteral">&#39;U&#39;</span>, <span class="charliteral">&#39;I&#39;</span>,</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="charliteral">&#39;O&#39;</span>, <span class="charliteral">&#39;P&#39;</span>, <span class="charliteral">&#39;{&#39;</span>, <span class="charliteral">&#39;}&#39;</span>, <a class="code" href="keyboard_8c.html#a9dba8e1e667dc0da64c02c196b750a7a">ENT</a>, <a class="code" href="keyboard_8c.html#ac16e9c5c93955f2c396aaa9829b72323">CTL</a>, <span class="charliteral">&#39;A&#39;</span>, <span class="charliteral">&#39;S&#39;</span>, <span class="comment">// 1</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="charliteral">&#39;D&#39;</span>, <span class="charliteral">&#39;F&#39;</span>, <span class="charliteral">&#39;G&#39;</span>, <span class="charliteral">&#39;H&#39;</span>, <span class="charliteral">&#39;J&#39;</span>, <span class="charliteral">&#39;K&#39;</span>, <span class="charliteral">&#39;L&#39;</span>, <span class="charliteral">&#39;:&#39;</span>,</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="charliteral">&#39;&quot;&#39;</span>, <span class="charliteral">&#39;~&#39;</span>, <a class="code" href="keyboard_8c.html#a3cbd3b51b8f703d3e48999f01a764541">SHF</a>, <span class="charliteral">&#39;|&#39;</span>, <span class="charliteral">&#39;Z&#39;</span>, <span class="charliteral">&#39;X&#39;</span>, <span class="charliteral">&#39;C&#39;</span>, <span class="charliteral">&#39;V&#39;</span>, <span class="comment">// 2</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="charliteral">&#39;B&#39;</span>, <span class="charliteral">&#39;N&#39;</span>, <span class="charliteral">&#39;M&#39;</span>, <span class="charliteral">&#39;&lt;&#39;</span>, <span class="charliteral">&#39;&gt;&#39;</span>, <span class="charliteral">&#39;?&#39;</span>, <a class="code" href="keyboard_8c.html#a3cbd3b51b8f703d3e48999f01a764541">SHF</a>, <a class="code" href="keyboard_8c.html#a46eb462e05a3197e84ff95d874d67f34">PSC</a>,</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <a class="code" href="keyboard_8c.html#a9d8a33b1a8b82b9913a0ba70438d45be">ALT</a>, <span class="charliteral">&#39; &#39;</span>, <a class="code" href="keyboard_8c.html#a4b355291fe6b8ba8e167ab0faa862e45">CLK</a>, <a class="code" href="keyboard_8c.html#a435f756795e3454fe3e181d5434515ca">F_1</a>, <a class="code" href="keyboard_8c.html#af0d28d590ed60c797d6caec15ceccdd0">F_2</a>, <a class="code" href="keyboard_8c.html#a8f409cf3682b3db2d1d48ae947e8ca71">F_3</a>, <a class="code" href="keyboard_8c.html#a7db10cdc8b1ff4a1880528ac1cb12686">F_4</a>, <a class="code" href="keyboard_8c.html#adc62e34d3d434791472398628ae91f16">F_5</a>, <span class="comment">// 3</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <a class="code" href="keyboard_8c.html#ae2c99833f0529c30cacd5229aad81125">F_6</a>, <a class="code" href="keyboard_8c.html#a177007ee38c6d2ad8a462e4296b56244">F_7</a>, <a class="code" href="keyboard_8c.html#a746a5dc770f29d218377bf82d53a405d">F_8</a>, <a class="code" href="keyboard_8c.html#a595ccf4674f4cea3175b56efedb26d33">F_9</a>, <a class="code" href="keyboard_8c.html#a9ba8300113c516255f356f9bd121c518">F10</a>, <a class="code" href="keyboard_8c.html#af73f5decf6cbc5a244cec630cf0cc292">NLK</a>, <a class="code" href="keyboard_8c.html#a6339220d7a81d2c89a391ce5494ca2e3">SLK</a>, <a class="code" href="keyboard_8c.html#a1f4ff2a884f2f41f545230116a6442ee">KHM</a>,</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <a class="code" href="keyboard_8c.html#adce94db96a966370f2e48f90c96fb24a">KUP</a>, <a class="code" href="keyboard_8c.html#a1276354d08e936827e42bbb7db1fe34d">KPU</a>, <a class="code" href="keyboard_8c.html#aa77f0542f09ee7a9c12712dace9bfa80">KMI</a>, <a class="code" href="keyboard_8c.html#ae94ef7c80cd78acb2497a7bd6e4059d5">KLT</a>, <a class="code" href="keyboard_8c.html#a43671298f16eb7f8bcdfa53d87142ac2">KCT</a>, <a class="code" href="keyboard_8c.html#ace5e58d807b4e952987cfac5422be7a4">KRT</a>, <a class="code" href="keyboard_8c.html#acfe552a3625b01348ebdde65192f69f0">KPL</a>, <a class="code" href="keyboard_8c.html#a9fdd8498502d4c5d45ccf54eb80a2254">KEN</a>, <span class="comment">// 4</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <a class="code" href="keyboard_8c.html#a5d31dc96753cf56b7242a24a6ce84952">KDN</a>, <a class="code" href="keyboard_8c.html#a7b182df4413aa6cf1967afa0665a6db0">KPD</a>, <a class="code" href="keyboard_8c.html#aae051115a74a6f9544925894a8d00891">KIN</a>, <a class="code" href="keyboard_8c.html#a80b2763f63f3068e81a5933d44fbb6af">KDL</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a99f005ac9af7ee84e760e99b4b63b702">F11</a>,</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <a class="code" href="keyboard_8c.html#ad482c9af265b4abca9a472209d2273dc">F12</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <span class="comment">// 5</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <a class="code" href="keyboard_8c.html#ab380112d877adff3c3ccc7877a01be36">SES</a>, <a class="code" href="keyboard_8c.html#ab380112d877adff3c3ccc7877a01be36">SES</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>,</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <span class="comment">// 6</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>,</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <span class="comment">// 7</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    },</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    .unshifted =</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;    {</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a4af1b6159e447ba72652bb7fcdfa726e">ESC</a>, <span class="charliteral">&#39;1&#39;</span>, <span class="charliteral">&#39;2&#39;</span>, <span class="charliteral">&#39;3&#39;</span>, <span class="charliteral">&#39;4&#39;</span>, <span class="charliteral">&#39;5&#39;</span>, <span class="charliteral">&#39;6&#39;</span>,</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="charliteral">&#39;7&#39;</span>, <span class="charliteral">&#39;8&#39;</span>, <span class="charliteral">&#39;9&#39;</span>, <span class="charliteral">&#39;0&#39;</span>, <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;=&#39;</span>, <a class="code" href="keyboard_8c.html#a0943e7097f3f59fdf4ce00ead17bfab5">BSP</a>, <a class="code" href="keyboard_8c.html#ad58a1fbfc85c7e4790fc55e654f50221">TAB</a>, <span class="comment">// 0</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="charliteral">&#39;q&#39;</span>, <span class="charliteral">&#39;w&#39;</span>, <span class="charliteral">&#39;e&#39;</span>, <span class="charliteral">&#39;r&#39;</span>, <span class="charliteral">&#39;t&#39;</span>, <span class="charliteral">&#39;y&#39;</span>, <span class="charliteral">&#39;u&#39;</span>, <span class="charliteral">&#39;i&#39;</span>,</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="charliteral">&#39;o&#39;</span>, <span class="charliteral">&#39;p&#39;</span>, <span class="charliteral">&#39;[&#39;</span>, <span class="charliteral">&#39;]&#39;</span>, <a class="code" href="keyboard_8c.html#a9dba8e1e667dc0da64c02c196b750a7a">ENT</a>, <a class="code" href="keyboard_8c.html#ac16e9c5c93955f2c396aaa9829b72323">CTL</a>, <span class="charliteral">&#39;a&#39;</span>, <span class="charliteral">&#39;s&#39;</span>, <span class="comment">// 1</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="charliteral">&#39;d&#39;</span>, <span class="charliteral">&#39;f&#39;</span>, <span class="charliteral">&#39;g&#39;</span>, <span class="charliteral">&#39;h&#39;</span>, <span class="charliteral">&#39;j&#39;</span>, <span class="charliteral">&#39;k&#39;</span>, <span class="charliteral">&#39;l&#39;</span>, <span class="charliteral">&#39;;&#39;</span>,</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <a class="code" href="keyboard_8c.html#a9b88d338f018c2e5801f9b179fed5c88">APO</a>, <span class="charliteral">&#39;`&#39;</span>, <a class="code" href="keyboard_8c.html#a3cbd3b51b8f703d3e48999f01a764541">SHF</a>, <a class="code" href="keyboard_8c.html#a403a5d3d3c1422d27a56e5153f16c240">BSL</a>, <span class="charliteral">&#39;z&#39;</span>, <span class="charliteral">&#39;x&#39;</span>, <span class="charliteral">&#39;c&#39;</span>, <span class="charliteral">&#39;v&#39;</span>, <span class="comment">// 2</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="charliteral">&#39;b&#39;</span>, <span class="charliteral">&#39;n&#39;</span>, <span class="charliteral">&#39;m&#39;</span>, <span class="charliteral">&#39;,&#39;</span>, <span class="charliteral">&#39;.&#39;</span>, <span class="charliteral">&#39;/&#39;</span>, <a class="code" href="keyboard_8c.html#a3cbd3b51b8f703d3e48999f01a764541">SHF</a>, <a class="code" href="keyboard_8c.html#a46eb462e05a3197e84ff95d874d67f34">PSC</a>,</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <a class="code" href="keyboard_8c.html#a9d8a33b1a8b82b9913a0ba70438d45be">ALT</a>, <span class="charliteral">&#39; &#39;</span>, <a class="code" href="keyboard_8c.html#a4b355291fe6b8ba8e167ab0faa862e45">CLK</a>, <a class="code" href="keyboard_8c.html#a435f756795e3454fe3e181d5434515ca">F_1</a>, <a class="code" href="keyboard_8c.html#af0d28d590ed60c797d6caec15ceccdd0">F_2</a>, <a class="code" href="keyboard_8c.html#a8f409cf3682b3db2d1d48ae947e8ca71">F_3</a>, <a class="code" href="keyboard_8c.html#a7db10cdc8b1ff4a1880528ac1cb12686">F_4</a>, <a class="code" href="keyboard_8c.html#adc62e34d3d434791472398628ae91f16">F_5</a>, <span class="comment">// 3</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        <a class="code" href="keyboard_8c.html#ae2c99833f0529c30cacd5229aad81125">F_6</a>, <a class="code" href="keyboard_8c.html#a177007ee38c6d2ad8a462e4296b56244">F_7</a>, <a class="code" href="keyboard_8c.html#a746a5dc770f29d218377bf82d53a405d">F_8</a>, <a class="code" href="keyboard_8c.html#a595ccf4674f4cea3175b56efedb26d33">F_9</a>, <a class="code" href="keyboard_8c.html#a9ba8300113c516255f356f9bd121c518">F10</a>, <a class="code" href="keyboard_8c.html#af73f5decf6cbc5a244cec630cf0cc292">NLK</a>, <a class="code" href="keyboard_8c.html#a6339220d7a81d2c89a391ce5494ca2e3">SLK</a>, <a class="code" href="keyboard_8c.html#a1f4ff2a884f2f41f545230116a6442ee">KHM</a>,</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <a class="code" href="keyboard_8c.html#adce94db96a966370f2e48f90c96fb24a">KUP</a>, <a class="code" href="keyboard_8c.html#a1276354d08e936827e42bbb7db1fe34d">KPU</a>, <a class="code" href="keyboard_8c.html#aa77f0542f09ee7a9c12712dace9bfa80">KMI</a>, <a class="code" href="keyboard_8c.html#ae94ef7c80cd78acb2497a7bd6e4059d5">KLT</a>, <a class="code" href="keyboard_8c.html#a43671298f16eb7f8bcdfa53d87142ac2">KCT</a>, <a class="code" href="keyboard_8c.html#ace5e58d807b4e952987cfac5422be7a4">KRT</a>, <a class="code" href="keyboard_8c.html#acfe552a3625b01348ebdde65192f69f0">KPL</a>, <a class="code" href="keyboard_8c.html#a9fdd8498502d4c5d45ccf54eb80a2254">KEN</a>, <span class="comment">// 4</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <a class="code" href="keyboard_8c.html#a5d31dc96753cf56b7242a24a6ce84952">KDN</a>, <a class="code" href="keyboard_8c.html#a7b182df4413aa6cf1967afa0665a6db0">KPD</a>, <a class="code" href="keyboard_8c.html#aae051115a74a6f9544925894a8d00891">KIN</a>, <a class="code" href="keyboard_8c.html#a80b2763f63f3068e81a5933d44fbb6af">KDL</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a99f005ac9af7ee84e760e99b4b63b702">F11</a>,</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <a class="code" href="keyboard_8c.html#ad482c9af265b4abca9a472209d2273dc">F12</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <span class="comment">// 5</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <a class="code" href="keyboard_8c.html#ab380112d877adff3c3ccc7877a01be36">SES</a>, <a class="code" href="keyboard_8c.html#ab380112d877adff3c3ccc7877a01be36">SES</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>,</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <span class="comment">// 6</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>,</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <a class="code" href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a>, <span class="comment">// 7</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    },</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;};</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">/// Keyboard state.</span></div><div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="keyboard_8c.html">  108</a></span>&#160;<span class="comment"></span><span class="keyword">struct </span><a class="code" href="keyboard_8c.html#structkbstate">kbstate</a></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;{</div><div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a749261791b3d9b42dec5899c7dc40501">  110</a></span>&#160;    keylayout_t  <a class="code" href="keyboard_8c.html#a749261791b3d9b42dec5899c7dc40501">layout</a>;          <span class="comment">///&lt; The installed keyboard layout.</span></div><div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="keyboard_8c.html#ac1f43557993fb4ce8595fb71c0393f48">  111</a></span>&#160;<span class="comment"></span>    uint8_t      <a class="code" href="keyboard_8c.html#ac1f43557993fb4ce8595fb71c0393f48">meta</a>;            <span class="comment">///&lt; Mask of meta keys currently pressed.</span></div><div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a33d2f7c06fdbec8ab652d063c45d8894">  112</a></span>&#160;<span class="comment"></span>    uint8_t      <a class="code" href="keyboard_8c.html#a33d2f7c06fdbec8ab652d063c45d8894">buf_head</a>;        <span class="comment">///&lt; Index of oldest key in buf.</span></div><div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="keyboard_8c.html#ae4c7324a15a4e830cdb0f64b47492a78">  113</a></span>&#160;<span class="comment"></span>    uint8_t      <a class="code" href="keyboard_8c.html#ae4c7324a15a4e830cdb0f64b47492a78">buf_tail</a>;        <span class="comment">///&lt; Index of next empty slot in buf.</span></div><div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a1dcef8fcd39a8d43931e2c1c54e993fb">  114</a></span>&#160;<span class="comment"></span>    atomic_uchar <a class="code" href="keyboard_8c.html#a1dcef8fcd39a8d43931e2c1c54e993fb">buf_size</a>;        <span class="comment">///&lt; Number of keys in the buf.</span></div><div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a3017f508a0ccd1de9eb8de3a198f38a3">  115</a></span>&#160;<span class="comment"></span>    key_t        <a class="code" href="keyboard_8c.html#a3017f508a0ccd1de9eb8de3a198f38a3">buf</a>[<a class="code" href="keyboard_8c.html#a8d84f7f555ffa92f34268350c4ed1387">MAX_BUFSIZ</a>]; <span class="comment">///&lt; Buffer holding unconsumed keys.</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"></span>};</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="keyboard_8c.html#structkbstate">kbstate</a> kbstate_t;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">/// Current keyboard state.</span></div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">  121</a></span>&#160;<span class="comment"></span><span class="keyword">static</span> kbstate_t <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span></div><div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="keyboard_8c.html#a067243058338a9a22a565422d28092f6">  124</a></span>&#160;<a class="code" href="keyboard_8c.html#a067243058338a9a22a565422d28092f6">toggle</a>(uint8_t flag)</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;{</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta &amp; flag)</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta &amp;= ~flag;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta |= flag;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;}</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="keyboard_8c.html#ae164a8d5e76b5194d0358929b7087c0e">  133</a></span>&#160;<a class="code" href="keyboard_8c.html#ae164a8d5e76b5194d0358929b7087c0e">addkey</a>(uint8_t brk, uint8_t <a class="code" href="keyboard_8c.html#ac1f43557993fb4ce8595fb71c0393f48">meta</a>, uint8_t code, uint8_t ch)</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// Reset the scan code escape state whenever a new key is added to the</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// buffer.</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta &amp;= ~<a class="code" href="keyboard_8h.html#a244e9bd68a241e2eec1bcefe3f044c08">META_ESCAPED</a>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="comment">// Is the buffer full?</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <span class="comment">// There is no need for an atomic comparison here, because the ISR</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <span class="comment">// function calling addkey can never be interrupted by anything that</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// touches the buffer.</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_size == <a class="code" href="keyboard_8c.html#a8d84f7f555ffa92f34268350c4ed1387">MAX_BUFSIZ</a>)</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">return</span>;</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    key_t <a class="code" href="keyboard_8h.html#structkey">key</a> =</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        .<a class="code" href="keyboard_8h.html#afd4b2258e3ca12ad01edc61000667709">brk</a>  = brk,</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        .meta = <a class="code" href="keyboard_8c.html#ac1f43557993fb4ce8595fb71c0393f48">meta</a>,</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        .code = code,</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        .ch   = ch</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    };</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// Add the character to the tail of the buffer.</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf[<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_tail++] = key;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_tail == <a class="code" href="keyboard_8c.html#a8d84f7f555ffa92f34268350c4ed1387">MAX_BUFSIZ</a>)</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_tail = 0;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="comment">// state.buf_size++;</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    atomic_fetch_add_explicit(&amp;<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_size, 1, memory_order_relaxed);</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span></div><div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="keyboard_8c.html#aff3d818f160d44f097c90fed2ed0e091">  164</a></span>&#160;<a class="code" href="keyboard_8c.html#aff3d818f160d44f097c90fed2ed0e091">isr_keyboard</a>(<span class="keyword">const</span> interrupt_context_t *<a class="code" href="paging_8c.html#structcontext">context</a>)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;{</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    (void)context;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// Get the scan code and the break state (key up or key down).</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    uint8_t scancode = <a class="code" href="cpu__inl_8h.html#a51126daa233e648ce97bbcdeb960e7de">io_inb</a>(<a class="code" href="keyboard_8c.html#a75d086fb1bfdedee4b3084000b7340aa">KB_PORT_DATA</a>);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordtype">bool</span>    keyup    = !!(scancode &amp; 0x80);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    <span class="comment">// Chop off the break bit.</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    scancode &amp;= ~0x80;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">// Get the shifted state.</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <span class="keywordtype">bool</span> shifted = !!(<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta &amp; <a class="code" href="keyboard_8h.html#adefacaad311acd11c6a64ebc21a9520e">META_SHIFT</a>);</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="comment">// Convert the scan code into an unshifted key code.</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    uint8_t ukeycode = <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.layout.unshifted[scancode];</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// Is the key a keyboard scan escape code? If so, don&#39;t add it to the</span></div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="comment">// buffer, but track the escape as a meta-state.</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">if</span> (ukeycode == <a class="code" href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8dad775abc51db8d3d187ea4389672d4abf">KEY_SCANESC</a>) {</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta |= <a class="code" href="keyboard_8h.html#a244e9bd68a241e2eec1bcefe3f044c08">META_ESCAPED</a>;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">goto</span> done;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    }</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">// Alter shift state based on capslock state.</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta &amp; <a class="code" href="keyboard_8h.html#a5f4d418d6df998b85f3e15412de61c87">META_CAPSLOCK</a>) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="keywordflow">if</span> ((ukeycode &gt;= <span class="charliteral">&#39;a&#39;</span>) &amp;&amp; (ukeycode &lt;= <span class="charliteral">&#39;z&#39;</span>))</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            shifted = !shifted;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    }</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="comment">// Convert the scan code to a properly shifted key code.</span></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    uint8_t <a class="code" href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8d">keycode</a> = shifted ? <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.layout.shifted[scancode] : ukeycode;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// Key up?</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keywordflow">if</span> (keyup) {</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keywordflow">switch</span> (keycode)</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8da7d538b177ab06797012e9ffb1449acd9">KEY_SHIFT</a>:</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta &amp;= ~<a class="code" href="keyboard_8h.html#adefacaad311acd11c6a64ebc21a9520e">META_SHIFT</a>;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8da03b9f1caf27fb28b593880fdca9cfe66">KEY_CTRL</a>:</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta &amp;= ~<a class="code" href="keyboard_8h.html#af45cac66992ac876656e182b2061ac6a">META_CTRL</a>;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8daf22ac608afcf783bb841f664a2620ca6">KEY_ALT</a>:</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta &amp;= ~<a class="code" href="keyboard_8h.html#ad634625f3976f487d552cfbf85e7f673">META_ALT</a>;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8daeb0b14cf15c6baf4ba90bc84bc84e7d3">KEY_CAPSLOCK</a>:</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                <a class="code" href="keyboard_8c.html#a067243058338a9a22a565422d28092f6">toggle</a>(<a class="code" href="keyboard_8h.html#a5f4d418d6df998b85f3e15412de61c87">META_CAPSLOCK</a>);</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8daa98feaa9c2c57dc8e7b04cb8fddc1a61">KEY_NUMLOCK</a>:</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                <a class="code" href="keyboard_8c.html#a067243058338a9a22a565422d28092f6">toggle</a>(<a class="code" href="keyboard_8h.html#aa9c2f743f5ed3bed007844e208e97942">META_NUMLOCK</a>);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8dac349dea39e2cf8d32573b4a4862df435">KEY_SCRLOCK</a>:</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                <a class="code" href="keyboard_8c.html#a067243058338a9a22a565422d28092f6">toggle</a>(<a class="code" href="keyboard_8h.html#a51fbf9ff37f2a84a49c7b115643a97e7">META_SCRLOCK</a>);</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        }</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <a class="code" href="keyboard_8c.html#ae164a8d5e76b5194d0358929b7087c0e">addkey</a>(<a class="code" href="keyboard_8h.html#a6b9af36e91a5fde57e91a6af97591ba4">KEYBRK_UP</a>, <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta, ukeycode, 0);</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// Key down?</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        <span class="keywordflow">switch</span> (keycode)</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        {</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8da7d538b177ab06797012e9ffb1449acd9">KEY_SHIFT</a>:</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta |= <a class="code" href="keyboard_8h.html#adefacaad311acd11c6a64ebc21a9520e">META_SHIFT</a>;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8da03b9f1caf27fb28b593880fdca9cfe66">KEY_CTRL</a>:</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta |= <a class="code" href="keyboard_8h.html#af45cac66992ac876656e182b2061ac6a">META_CTRL</a>;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8daf22ac608afcf783bb841f664a2620ca6">KEY_ALT</a>:</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta |= <a class="code" href="keyboard_8h.html#ad634625f3976f487d552cfbf85e7f673">META_ALT</a>;</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                <span class="keywordflow">break</span>;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <span class="comment">// Convert the key to a character.</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordtype">char</span> ch = 0;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        <span class="keywordflow">if</span> (keycode &lt; 0x80) {</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="keywordflow">switch</span> (<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta &amp; (<a class="code" href="keyboard_8h.html#af45cac66992ac876656e182b2061ac6a">META_CTRL</a> | <a class="code" href="keyboard_8h.html#ad634625f3976f487d552cfbf85e7f673">META_ALT</a>))</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                    ch = (char)keycode;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="keyboard_8h.html#af45cac66992ac876656e182b2061ac6a">META_CTRL</a>:</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                    <span class="keywordflow">if</span> ((ukeycode &gt;= <span class="charliteral">&#39;a&#39;</span>) &amp;&amp; (ukeycode &lt;= <span class="charliteral">&#39;z&#39;</span>))</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                        ch = (char)(ukeycode - <span class="charliteral">&#39;a&#39;</span> + 1);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    <span class="keywordflow">break</span>;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <a class="code" href="keyboard_8c.html#ae164a8d5e76b5194d0358929b7087c0e">addkey</a>(<a class="code" href="keyboard_8h.html#a4f18c2e6e5096a97ae64f13c9a272ce9">KEYBRK_DOWN</a>, <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta, ukeycode, ch);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;done:</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// Send the end-of-interrupt signal.</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="cpu__inl_8h.html#a7d7614d30804fb909bbb053c6d118c97">io_outb</a>(<a class="code" href="interrupt_8h.html#abcb05c0b9d04500b05aad3cc3628bf32">PIC_PORT_CMD_MASTER</a>, <a class="code" href="interrupt_8h.html#a21165ce2c5bc6b64176dda7fbe9a4ec7">PIC_CMD_EOI</a>);</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;}</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00268"></a><span class="lineno"><a class="line" href="keyboard_8h.html#a24c82be472923a5525438e2c2aecc8f4">  268</a></span>&#160;<a class="code" href="keyboard_8c.html#a24c82be472923a5525438e2c2aecc8f4">kb_init</a>()</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;{</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="comment">// Default to the PSC/2 keyboard layout.</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <a class="code" href="string_8h.html#a37562939be846210ce0560a6168cd7f1">memcpy</a>(&amp;<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.layout, &amp;<a class="code" href="keyboard_8c.html#a3fe10b73f8efc167fb2d42ae57659226">ps2_layout</a>, <span class="keyword">sizeof</span>(<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.layout));</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="comment">// Initialize keyboard state.</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta     = 0;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_head = 0;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_tail = 0;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_size = 0;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <a class="code" href="string_8h.html#a0558cc9ce1b933b8504491c2d5e77382">memzero</a>(&amp;<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf, <span class="keyword">sizeof</span>(<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf));</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">// Assign the interrupt service routine.</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="interrupt_8h.html#ac6a328a9ac7ffd0f127738fdaa79d4cb">isr_set</a>(<a class="code" href="interrupt_8h.html#ac182fa4bc97c37eaa1b3a074488ca13e">TRAP_IRQ_KEYBOARD</a>, <a class="code" href="keyboard_8c.html#aff3d818f160d44f097c90fed2ed0e091">isr_keyboard</a>);</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="comment">// Enable the keyboard hardware interrupt (IRQ1).</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <a class="code" href="interrupt_8h.html#ae166b92bad5046739af1c5511fda6ee4">irq_enable</a>(<a class="code" href="interrupt_8h.html#a8092843c014fad609c1b01a4604a44a3">IRQ_KEYBOARD</a>);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;}</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="keywordtype">void</span></div><div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="keyboard_8h.html#aecc95113843140a204b73f9239fc7532">  288</a></span>&#160;<a class="code" href="keyboard_8c.html#aecc95113843140a204b73f9239fc7532">kb_setlayout</a>(keylayout_t *<a class="code" href="keyboard_8c.html#a749261791b3d9b42dec5899c7dc40501">layout</a>)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;{</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <a class="code" href="string_8h.html#a37562939be846210ce0560a6168cd7f1">memcpy</a>(&amp;<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.layout, layout, <span class="keyword">sizeof</span>(<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.layout));</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;}</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="keywordtype">char</span></div><div class="line"><a name="l00294"></a><span class="lineno"><a class="line" href="keyboard_8h.html#adae01683b54a13ace30d964858bfbb77">  294</a></span>&#160;<a class="code" href="keyboard_8c.html#adae01683b54a13ace30d964858bfbb77">kb_getchar</a>()</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;{</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">for</span> (;;) {</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="comment">// Buffer empty? (state.buf_size == 0?) Check atomically because</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="comment">// this function could be interrupted by the keyboard ISR.</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        uint8_t size = 0;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">if</span> (atomic_compare_exchange_strong(&amp;<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_size, &amp;size, 0))</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="comment">// Pull the next character from the head of the buffer.</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordtype">char</span> ch = <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf[<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_head++].ch;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_head == <a class="code" href="keyboard_8c.html#a8d84f7f555ffa92f34268350c4ed1387">MAX_BUFSIZ</a>)</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_head = 0;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="comment">// state.buf_size--</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        atomic_fetch_sub_explicit(&amp;<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_size, 1, memory_order_relaxed);</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="comment">// Valid character?</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">if</span> (ch != 0)</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="keywordflow">return</span> ch;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    }</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;}</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="keywordtype">bool</span></div><div class="line"><a name="l00318"></a><span class="lineno"><a class="line" href="keyboard_8h.html#acaacd930124f8702503b1df10c28be83">  318</a></span>&#160;<a class="code" href="keyboard_8c.html#acaacd930124f8702503b1df10c28be83">kb_getkey</a>(key_t *<a class="code" href="keyboard_8h.html#structkey">key</a>)</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;{</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="comment">// Buffer empty? (state.buf_size == 0?) Check atomically because this</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// function could be interrupted by the keyboard ISR.</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    uint8_t size = 0;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">if</span> (atomic_compare_exchange_strong(&amp;<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_size, &amp;size, 0)) {</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        *(uint32_t *)key = 0;</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <span class="comment">// Pull the next character from the head of the buffer.</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    *key = <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf[<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_head++];</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_head == <a class="code" href="keyboard_8c.html#a8d84f7f555ffa92f34268350c4ed1387">MAX_BUFSIZ</a>)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_head = 0;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="comment">// state.buf_size--</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    atomic_fetch_sub_explicit(&amp;<a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.buf_size, 1, memory_order_relaxed);</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;uint8_t</div><div class="line"><a name="l00340"></a><span class="lineno"><a class="line" href="keyboard_8h.html#af4eae826ac09f5604cb35eda4da23867">  340</a></span>&#160;<a class="code" href="keyboard_8c.html#af4eae826ac09f5604cb35eda4da23867">kb_meta</a>()</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;{</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a>.meta;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;}</div><div class="ttc" id="keyboard_8h_html_a72c2f699b3146f912507ee67d7ab0e8da7d538b177ab06797012e9ffb1449acd9"><div class="ttname"><a href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8da7d538b177ab06797012e9ffb1449acd9">KEY_SHIFT</a></div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00045">keyboard.h:45</a></div></div>
<div class="ttc" id="keyboard_8c_html_a9d8a33b1a8b82b9913a0ba70438d45be"><div class="ttname"><a href="keyboard_8c.html#a9d8a33b1a8b82b9913a0ba70438d45be">ALT</a></div><div class="ttdeci">#define ALT</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00029">keyboard.c:29</a></div></div>
<div class="ttc" id="keyboard_8c_html_acaacd930124f8702503b1df10c28be83"><div class="ttname"><a href="keyboard_8c.html#acaacd930124f8702503b1df10c28be83">kb_getkey</a></div><div class="ttdeci">bool kb_getkey(key_t *key)</div><div class="ttdoc">Return the available next key from the keyboard&amp;#39;s input buffer. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00318">keyboard.c:318</a></div></div>
<div class="ttc" id="interrupt_8h_html_abcb05c0b9d04500b05aad3cc3628bf32"><div class="ttname"><a href="interrupt_8h.html#abcb05c0b9d04500b05aad3cc3628bf32">PIC_PORT_CMD_MASTER</a></div><div class="ttdeci">#define PIC_PORT_CMD_MASTER</div><div class="ttdoc">Command port for master PIC. </div><div class="ttdef"><b>Definition:</b> <a href="interrupt_8h_source.html#l00028">interrupt.h:28</a></div></div>
<div class="ttc" id="keyboard_8c_html_af4eae826ac09f5604cb35eda4da23867"><div class="ttname"><a href="keyboard_8c.html#af4eae826ac09f5604cb35eda4da23867">kb_meta</a></div><div class="ttdeci">uint8_t kb_meta()</div><div class="ttdoc">Return the current meta-key bit mask. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00340">keyboard.c:340</a></div></div>
<div class="ttc" id="keyboard_8h_html_a4f18c2e6e5096a97ae64f13c9a272ce9"><div class="ttname"><a href="keyboard_8h.html#a4f18c2e6e5096a97ae64f13c9a272ce9">KEYBRK_DOWN</a></div><div class="ttdeci">#define KEYBRK_DOWN</div><div class="ttdoc">Key-down break code. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00019">keyboard.h:19</a></div></div>
<div class="ttc" id="keyboard_8h_html_adefacaad311acd11c6a64ebc21a9520e"><div class="ttname"><a href="keyboard_8h.html#adefacaad311acd11c6a64ebc21a9520e">META_SHIFT</a></div><div class="ttdeci">#define META_SHIFT</div><div class="ttdoc">Set while the shift key is pressed. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00023">keyboard.h:23</a></div></div>
<div class="ttc" id="cpu__inl_8h_html_a51126daa233e648ce97bbcdeb960e7de"><div class="ttname"><a href="cpu__inl_8h.html#a51126daa233e648ce97bbcdeb960e7de">io_inb</a></div><div class="ttdeci">__forceinline uint8_t io_inb(uint16_t port)</div><div class="ttdef"><b>Definition:</b> <a href="cpu__inl_8h_source.html#l00047">cpu_inl.h:47</a></div></div>
<div class="ttc" id="keyboard_8h_html_a51fbf9ff37f2a84a49c7b115643a97e7"><div class="ttname"><a href="keyboard_8h.html#a51fbf9ff37f2a84a49c7b115643a97e7">META_SCRLOCK</a></div><div class="ttdeci">#define META_SCRLOCK</div><div class="ttdoc">Set while scroll lock is on. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00029">keyboard.h:29</a></div></div>
<div class="ttc" id="cpu__inl_8h_html_a7d7614d30804fb909bbb053c6d118c97"><div class="ttname"><a href="cpu__inl_8h.html#a7d7614d30804fb909bbb053c6d118c97">io_outb</a></div><div class="ttdeci">__forceinline void io_outb(uint16_t port, uint8_t value)</div><div class="ttdef"><b>Definition:</b> <a href="cpu__inl_8h_source.html#l00059">cpu_inl.h:59</a></div></div>
<div class="ttc" id="keyboard_8c_html_ac16e9c5c93955f2c396aaa9829b72323"><div class="ttname"><a href="keyboard_8c.html#ac16e9c5c93955f2c396aaa9829b72323">CTL</a></div><div class="ttdeci">#define CTL</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00027">keyboard.c:27</a></div></div>
<div class="ttc" id="interrupt_8h_html_a21165ce2c5bc6b64176dda7fbe9a4ec7"><div class="ttname"><a href="interrupt_8h.html#a21165ce2c5bc6b64176dda7fbe9a4ec7">PIC_CMD_EOI</a></div><div class="ttdeci">#define PIC_CMD_EOI</div><div class="ttdoc">End of interrupt. </div><div class="ttdef"><b>Definition:</b> <a href="interrupt_8h_source.html#l00034">interrupt.h:34</a></div></div>
<div class="ttc" id="string_8h_html"><div class="ttname"><a href="string_8h.html">string.h</a></div><div class="ttdoc">String and memory operations. </div></div>
<div class="ttc" id="keyboard_8c_html_a43671298f16eb7f8bcdfa53d87142ac2"><div class="ttname"><a href="keyboard_8c.html#a43671298f16eb7f8bcdfa53d87142ac2">KCT</a></div><div class="ttdeci">#define KCT</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00039">keyboard.c:39</a></div></div>
<div class="ttc" id="keyboard_8c_html_a3017f508a0ccd1de9eb8de3a198f38a3"><div class="ttname"><a href="keyboard_8c.html#a3017f508a0ccd1de9eb8de3a198f38a3">kbstate::buf</a></div><div class="ttdeci">key_t buf[MAX_BUFSIZ]</div><div class="ttdoc">Buffer holding unconsumed keys. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00115">keyboard.c:115</a></div></div>
<div class="ttc" id="keyboard_8c_html_adce94db96a966370f2e48f90c96fb24a"><div class="ttname"><a href="keyboard_8c.html#adce94db96a966370f2e48f90c96fb24a">KUP</a></div><div class="ttdeci">#define KUP</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00042">keyboard.c:42</a></div></div>
<div class="ttc" id="interrupt_8h_html_ac182fa4bc97c37eaa1b3a074488ca13e"><div class="ttname"><a href="interrupt_8h.html#ac182fa4bc97c37eaa1b3a074488ca13e">TRAP_IRQ_KEYBOARD</a></div><div class="ttdeci">#define TRAP_IRQ_KEYBOARD</div><div class="ttdef"><b>Definition:</b> <a href="interrupt_8h_source.html#l00025">interrupt.h:25</a></div></div>
<div class="ttc" id="interrupt_8h_html_ac6a328a9ac7ffd0f127738fdaa79d4cb"><div class="ttname"><a href="interrupt_8h.html#ac6a328a9ac7ffd0f127738fdaa79d4cb">isr_set</a></div><div class="ttdeci">void isr_set(int interrupt, isr_handler handler)</div><div class="ttdoc">Set an interrupt service routine for the given interrupt number. </div></div>
<div class="ttc" id="keyboard_8h_html"><div class="ttname"><a href="keyboard_8h.html">keyboard.h</a></div><div class="ttdoc">Keyboard input routines. </div></div>
<div class="ttc" id="keyboard_8c_html_a9ba8300113c516255f356f9bd121c518"><div class="ttname"><a href="keyboard_8c.html#a9ba8300113c516255f356f9bd121c518">F10</a></div><div class="ttdeci">#define F10</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00056">keyboard.c:56</a></div></div>
<div class="ttc" id="keyboard_8c_html_af73f5decf6cbc5a244cec630cf0cc292"><div class="ttname"><a href="keyboard_8c.html#af73f5decf6cbc5a244cec630cf0cc292">NLK</a></div><div class="ttdeci">#define NLK</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00032">keyboard.c:32</a></div></div>
<div class="ttc" id="keyboard_8c_html_a403a5d3d3c1422d27a56e5153f16c240"><div class="ttname"><a href="keyboard_8c.html#a403a5d3d3c1422d27a56e5153f16c240">BSL</a></div><div class="ttdeci">#define BSL</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00062">keyboard.c:62</a></div></div>
<div class="ttc" id="core_8h_html"><div class="ttname"><a href="core_8h.html">core.h</a></div><div class="ttdoc">Core include file. </div></div>
<div class="ttc" id="keyboard_8c_html_structkbstate"><div class="ttname"><a href="keyboard_8c.html#structkbstate">kbstate</a></div><div class="ttdoc">Keyboard state. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00108">keyboard.c:108</a></div></div>
<div class="ttc" id="keyboard_8h_html_a5f4d418d6df998b85f3e15412de61c87"><div class="ttname"><a href="keyboard_8h.html#a5f4d418d6df998b85f3e15412de61c87">META_CAPSLOCK</a></div><div class="ttdeci">#define META_CAPSLOCK</div><div class="ttdoc">Set while caps lock is on. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00027">keyboard.h:27</a></div></div>
<div class="ttc" id="keyboard_8c_html_a749261791b3d9b42dec5899c7dc40501"><div class="ttname"><a href="keyboard_8c.html#a749261791b3d9b42dec5899c7dc40501">kbstate::layout</a></div><div class="ttdeci">keylayout_t layout</div><div class="ttdoc">The installed keyboard layout. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00110">keyboard.c:110</a></div></div>
<div class="ttc" id="keyboard_8c_html_ae94ef7c80cd78acb2497a7bd6e4059d5"><div class="ttname"><a href="keyboard_8c.html#ae94ef7c80cd78acb2497a7bd6e4059d5">KLT</a></div><div class="ttdeci">#define KLT</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00038">keyboard.c:38</a></div></div>
<div class="ttc" id="keyboard_8c_html_a177007ee38c6d2ad8a462e4296b56244"><div class="ttname"><a href="keyboard_8c.html#a177007ee38c6d2ad8a462e4296b56244">F_7</a></div><div class="ttdeci">#define F_7</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00053">keyboard.c:53</a></div></div>
<div class="ttc" id="keyboard_8c_html_aa77f0542f09ee7a9c12712dace9bfa80"><div class="ttname"><a href="keyboard_8c.html#aa77f0542f09ee7a9c12712dace9bfa80">KMI</a></div><div class="ttdeci">#define KMI</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00045">keyboard.c:45</a></div></div>
<div class="ttc" id="interrupt_8h_html_a8092843c014fad609c1b01a4604a44a3"><div class="ttname"><a href="interrupt_8h.html#a8092843c014fad609c1b01a4604a44a3">IRQ_KEYBOARD</a></div><div class="ttdeci">#define IRQ_KEYBOARD</div><div class="ttdef"><b>Definition:</b> <a href="interrupt_8h_source.html#l00021">interrupt.h:21</a></div></div>
<div class="ttc" id="keyboard_8c_html_a1f4ff2a884f2f41f545230116a6442ee"><div class="ttname"><a href="keyboard_8c.html#a1f4ff2a884f2f41f545230116a6442ee">KHM</a></div><div class="ttdeci">#define KHM</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00041">keyboard.c:41</a></div></div>
<div class="ttc" id="keyboard_8c_html_a435f756795e3454fe3e181d5434515ca"><div class="ttname"><a href="keyboard_8c.html#a435f756795e3454fe3e181d5434515ca">F_1</a></div><div class="ttdeci">#define F_1</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00047">keyboard.c:47</a></div></div>
<div class="ttc" id="keyboard_8c_html_a3fe10b73f8efc167fb2d42ae57659226"><div class="ttname"><a href="keyboard_8c.html#a3fe10b73f8efc167fb2d42ae57659226">ps2_layout</a></div><div class="ttdeci">static const keylayout_t ps2_layout</div><div class="ttdoc">US English PSC/2 keyboard scan map (default setting) </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00065">keyboard.c:65</a></div></div>
<div class="ttc" id="keyboard_8c_html_a9fdd8498502d4c5d45ccf54eb80a2254"><div class="ttname"><a href="keyboard_8c.html#a9fdd8498502d4c5d45ccf54eb80a2254">KEN</a></div><div class="ttdeci">#define KEN</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00035">keyboard.c:35</a></div></div>
<div class="ttc" id="keyboard_8c_html_a1276354d08e936827e42bbb7db1fe34d"><div class="ttname"><a href="keyboard_8c.html#a1276354d08e936827e42bbb7db1fe34d">KPU</a></div><div class="ttdeci">#define KPU</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00043">keyboard.c:43</a></div></div>
<div class="ttc" id="keyboard_8c_html_a24c82be472923a5525438e2c2aecc8f4"><div class="ttname"><a href="keyboard_8c.html#a24c82be472923a5525438e2c2aecc8f4">kb_init</a></div><div class="ttdeci">void kb_init()</div><div class="ttdoc">Initialize the keyboard so that it can provide input to the kernel. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00268">keyboard.c:268</a></div></div>
<div class="ttc" id="keyboard_8c_html_a7b182df4413aa6cf1967afa0665a6db0"><div class="ttname"><a href="keyboard_8c.html#a7b182df4413aa6cf1967afa0665a6db0">KPD</a></div><div class="ttdeci">#define KPD</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00037">keyboard.c:37</a></div></div>
<div class="ttc" id="keyboard_8c_html_a1dcef8fcd39a8d43931e2c1c54e993fb"><div class="ttname"><a href="keyboard_8c.html#a1dcef8fcd39a8d43931e2c1c54e993fb">kbstate::buf_size</a></div><div class="ttdeci">atomic_uchar buf_size</div><div class="ttdoc">Number of keys in the buf. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00114">keyboard.c:114</a></div></div>
<div class="ttc" id="keyboard_8c_html_adae01683b54a13ace30d964858bfbb77"><div class="ttname"><a href="keyboard_8c.html#adae01683b54a13ace30d964858bfbb77">kb_getchar</a></div><div class="ttdeci">char kb_getchar()</div><div class="ttdoc">Return the next available character from the keyboard&amp;#39;s input buffer. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00294">keyboard.c:294</a></div></div>
<div class="ttc" id="keyboard_8c_html_aecc95113843140a204b73f9239fc7532"><div class="ttname"><a href="keyboard_8c.html#aecc95113843140a204b73f9239fc7532">kb_setlayout</a></div><div class="ttdeci">void kb_setlayout(keylayout_t *layout)</div><div class="ttdoc">Install a new keyboard layout. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00288">keyboard.c:288</a></div></div>
<div class="ttc" id="keyboard_8h_html_af45cac66992ac876656e182b2061ac6a"><div class="ttname"><a href="keyboard_8h.html#af45cac66992ac876656e182b2061ac6a">META_CTRL</a></div><div class="ttdeci">#define META_CTRL</div><div class="ttdoc">Set while the ctrl key is pressed. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00024">keyboard.h:24</a></div></div>
<div class="ttc" id="keyboard_8c_html_a7db10cdc8b1ff4a1880528ac1cb12686"><div class="ttname"><a href="keyboard_8c.html#a7db10cdc8b1ff4a1880528ac1cb12686">F_4</a></div><div class="ttdeci">#define F_4</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00050">keyboard.c:50</a></div></div>
<div class="ttc" id="keyboard_8h_html_a72c2f699b3146f912507ee67d7ab0e8daf22ac608afcf783bb841f664a2620ca6"><div class="ttname"><a href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8daf22ac608afcf783bb841f664a2620ca6">KEY_ALT</a></div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00046">keyboard.h:46</a></div></div>
<div class="ttc" id="keyboard_8c_html_ad482c9af265b4abca9a472209d2273dc"><div class="ttname"><a href="keyboard_8c.html#ad482c9af265b4abca9a472209d2273dc">F12</a></div><div class="ttdeci">#define F12</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00058">keyboard.c:58</a></div></div>
<div class="ttc" id="keyboard_8c_html_ace5e58d807b4e952987cfac5422be7a4"><div class="ttname"><a href="keyboard_8c.html#ace5e58d807b4e952987cfac5422be7a4">KRT</a></div><div class="ttdeci">#define KRT</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00040">keyboard.c:40</a></div></div>
<div class="ttc" id="keyboard_8h_html_a72c2f699b3146f912507ee67d7ab0e8da03b9f1caf27fb28b593880fdca9cfe66"><div class="ttname"><a href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8da03b9f1caf27fb28b593880fdca9cfe66">KEY_CTRL</a></div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00044">keyboard.h:44</a></div></div>
<div class="ttc" id="keyboard_8h_html_a6b9af36e91a5fde57e91a6af97591ba4"><div class="ttname"><a href="keyboard_8h.html#a6b9af36e91a5fde57e91a6af97591ba4">KEYBRK_UP</a></div><div class="ttdeci">#define KEYBRK_UP</div><div class="ttdoc">Key-up break code. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00020">keyboard.h:20</a></div></div>
<div class="ttc" id="keyboard_8c_html_a9dba8e1e667dc0da64c02c196b750a7a"><div class="ttname"><a href="keyboard_8c.html#a9dba8e1e667dc0da64c02c196b750a7a">ENT</a></div><div class="ttdeci">#define ENT</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00025">keyboard.c:25</a></div></div>
<div class="ttc" id="keyboard_8c_html_a33d2f7c06fdbec8ab652d063c45d8894"><div class="ttname"><a href="keyboard_8c.html#a33d2f7c06fdbec8ab652d063c45d8894">kbstate::buf_head</a></div><div class="ttdeci">uint8_t buf_head</div><div class="ttdoc">Index of oldest key in buf. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00112">keyboard.c:112</a></div></div>
<div class="ttc" id="keyboard_8h_html_aa9c2f743f5ed3bed007844e208e97942"><div class="ttname"><a href="keyboard_8h.html#aa9c2f743f5ed3bed007844e208e97942">META_NUMLOCK</a></div><div class="ttdeci">#define META_NUMLOCK</div><div class="ttdoc">Set while num lock is on. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00028">keyboard.h:28</a></div></div>
<div class="ttc" id="keyboard_8c_html_aae051115a74a6f9544925894a8d00891"><div class="ttname"><a href="keyboard_8c.html#aae051115a74a6f9544925894a8d00891">KIN</a></div><div class="ttdeci">#define KIN</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00034">keyboard.c:34</a></div></div>
<div class="ttc" id="keyboard_8c_html_a067243058338a9a22a565422d28092f6"><div class="ttname"><a href="keyboard_8c.html#a067243058338a9a22a565422d28092f6">toggle</a></div><div class="ttdeci">static void toggle(uint8_t flag)</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00124">keyboard.c:124</a></div></div>
<div class="ttc" id="keyboard_8c_html_ac1f43557993fb4ce8595fb71c0393f48"><div class="ttname"><a href="keyboard_8c.html#ac1f43557993fb4ce8595fb71c0393f48">kbstate::meta</a></div><div class="ttdeci">uint8_t meta</div><div class="ttdoc">Mask of meta keys currently pressed. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00111">keyboard.c:111</a></div></div>
<div class="ttc" id="keyboard_8c_html_a4af1b6159e447ba72652bb7fcdfa726e"><div class="ttname"><a href="keyboard_8c.html#a4af1b6159e447ba72652bb7fcdfa726e">ESC</a></div><div class="ttdeci">#define ESC</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00026">keyboard.c:26</a></div></div>
<div class="ttc" id="keyboard_8h_html_a72c2f699b3146f912507ee67d7ab0e8dac349dea39e2cf8d32573b4a4862df435"><div class="ttname"><a href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8dac349dea39e2cf8d32573b4a4862df435">KEY_SCRLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00050">keyboard.h:50</a></div></div>
<div class="ttc" id="keyboard_8c_html_a0943e7097f3f59fdf4ce00ead17bfab5"><div class="ttname"><a href="keyboard_8c.html#a0943e7097f3f59fdf4ce00ead17bfab5">BSP</a></div><div class="ttdeci">#define BSP</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00023">keyboard.c:23</a></div></div>
<div class="ttc" id="interrupt_8h_html"><div class="ttname"><a href="interrupt_8h.html">interrupt.h</a></div><div class="ttdoc">Interrupt handling operations. </div></div>
<div class="ttc" id="keyboard_8h_html_afd4b2258e3ca12ad01edc61000667709"><div class="ttname"><a href="keyboard_8h.html#afd4b2258e3ca12ad01edc61000667709">key::brk</a></div><div class="ttdeci">uint8_t brk</div><div class="ttdoc">KEYBRK_UP or KEYBRK_DOWN. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00089">keyboard.h:89</a></div></div>
<div class="ttc" id="cpu_8h_html"><div class="ttname"><a href="cpu_8h.html">cpu.h</a></div><div class="ttdoc">x86 CPU-specific function implementations. </div></div>
<div class="ttc" id="keyboard_8c_html_a46eb462e05a3197e84ff95d874d67f34"><div class="ttname"><a href="keyboard_8c.html#a46eb462e05a3197e84ff95d874d67f34">PSC</a></div><div class="ttdeci">#define PSC</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00030">keyboard.c:30</a></div></div>
<div class="ttc" id="paging_8c_html_structcontext"><div class="ttname"><a href="paging_8c.html#structcontext">context</a></div><div class="ttdoc">The log context describes the state of the log buffers. </div><div class="ttdef"><b>Definition:</b> <a href="log_8c_source.html#l00046">log.c:46</a></div></div>
<div class="ttc" id="keyboard_8c_html_a7a00fd6bd8552a6d3fa38691127eda06"><div class="ttname"><a href="keyboard_8c.html#a7a00fd6bd8552a6d3fa38691127eda06">INV</a></div><div class="ttdeci">#define INV</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00060">keyboard.c:60</a></div></div>
<div class="ttc" id="interrupt_8h_html_ae166b92bad5046739af1c5511fda6ee4"><div class="ttname"><a href="interrupt_8h.html#ae166b92bad5046739af1c5511fda6ee4">irq_enable</a></div><div class="ttdeci">void irq_enable(uint8_t irq)</div><div class="ttdoc">Tell the PIC to enable a hardware interrupt. </div></div>
<div class="ttc" id="keyboard_8c_html_a4b355291fe6b8ba8e167ab0faa862e45"><div class="ttname"><a href="keyboard_8c.html#a4b355291fe6b8ba8e167ab0faa862e45">CLK</a></div><div class="ttdeci">#define CLK</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00031">keyboard.c:31</a></div></div>
<div class="ttc" id="keyboard_8c_html_a3cbd3b51b8f703d3e48999f01a764541"><div class="ttname"><a href="keyboard_8c.html#a3cbd3b51b8f703d3e48999f01a764541">SHF</a></div><div class="ttdeci">#define SHF</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00028">keyboard.c:28</a></div></div>
<div class="ttc" id="keyboard_8c_html_a595ccf4674f4cea3175b56efedb26d33"><div class="ttname"><a href="keyboard_8c.html#a595ccf4674f4cea3175b56efedb26d33">F_9</a></div><div class="ttdeci">#define F_9</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00055">keyboard.c:55</a></div></div>
<div class="ttc" id="keyboard_8c_html_aff3d818f160d44f097c90fed2ed0e091"><div class="ttname"><a href="keyboard_8c.html#aff3d818f160d44f097c90fed2ed0e091">isr_keyboard</a></div><div class="ttdeci">static void isr_keyboard(const interrupt_context_t *context)</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00164">keyboard.c:164</a></div></div>
<div class="ttc" id="keyboard_8c_html_a99f005ac9af7ee84e760e99b4b63b702"><div class="ttname"><a href="keyboard_8c.html#a99f005ac9af7ee84e760e99b4b63b702">F11</a></div><div class="ttdeci">#define F11</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00057">keyboard.c:57</a></div></div>
<div class="ttc" id="keyboard_8c_html_a80b2763f63f3068e81a5933d44fbb6af"><div class="ttname"><a href="keyboard_8c.html#a80b2763f63f3068e81a5933d44fbb6af">KDL</a></div><div class="ttdeci">#define KDL</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00044">keyboard.c:44</a></div></div>
<div class="ttc" id="keyboard_8c_html_ae164a8d5e76b5194d0358929b7087c0e"><div class="ttname"><a href="keyboard_8c.html#ae164a8d5e76b5194d0358929b7087c0e">addkey</a></div><div class="ttdeci">static void addkey(uint8_t brk, uint8_t meta, uint8_t code, uint8_t ch)</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00133">keyboard.c:133</a></div></div>
<div class="ttc" id="keyboard_8h_html_a72c2f699b3146f912507ee67d7ab0e8dad775abc51db8d3d187ea4389672d4abf"><div class="ttname"><a href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8dad775abc51db8d3d187ea4389672d4abf">KEY_SCANESC</a></div><div class="ttdoc">Escaped scan code. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00076">keyboard.h:76</a></div></div>
<div class="ttc" id="string_8h_html_a0558cc9ce1b933b8504491c2d5e77382"><div class="ttname"><a href="string_8h.html#a0558cc9ce1b933b8504491c2d5e77382">memzero</a></div><div class="ttdeci">void * memzero(void *dst, size_t num)</div><div class="ttdoc">Fill a region of memory with zeroes. </div></div>
<div class="ttc" id="keyboard_8c_html_a8f409cf3682b3db2d1d48ae947e8ca71"><div class="ttname"><a href="keyboard_8c.html#a8f409cf3682b3db2d1d48ae947e8ca71">F_3</a></div><div class="ttdeci">#define F_3</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00049">keyboard.c:49</a></div></div>
<div class="ttc" id="keyboard_8c_html_ad58a1fbfc85c7e4790fc55e654f50221"><div class="ttname"><a href="keyboard_8c.html#ad58a1fbfc85c7e4790fc55e654f50221">TAB</a></div><div class="ttdeci">#define TAB</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00024">keyboard.c:24</a></div></div>
<div class="ttc" id="keyboard_8c_html_ae2c99833f0529c30cacd5229aad81125"><div class="ttname"><a href="keyboard_8c.html#ae2c99833f0529c30cacd5229aad81125">F_6</a></div><div class="ttdeci">#define F_6</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00052">keyboard.c:52</a></div></div>
<div class="ttc" id="keyboard_8c_html_a8d84f7f555ffa92f34268350c4ed1387"><div class="ttname"><a href="keyboard_8c.html#a8d84f7f555ffa92f34268350c4ed1387">MAX_BUFSIZ</a></div><div class="ttdeci">#define MAX_BUFSIZ</div><div class="ttdoc">Keyboard input buffer size. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00020">keyboard.c:20</a></div></div>
<div class="ttc" id="keyboard_8c_html_a6339220d7a81d2c89a391ce5494ca2e3"><div class="ttname"><a href="keyboard_8c.html#a6339220d7a81d2c89a391ce5494ca2e3">SLK</a></div><div class="ttdeci">#define SLK</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00033">keyboard.c:33</a></div></div>
<div class="ttc" id="keyboard_8h_html_a72c2f699b3146f912507ee67d7ab0e8daa98feaa9c2c57dc8e7b04cb8fddc1a61"><div class="ttname"><a href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8daa98feaa9c2c57dc8e7b04cb8fddc1a61">KEY_NUMLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00049">keyboard.h:49</a></div></div>
<div class="ttc" id="keyboard_8h_html_ad634625f3976f487d552cfbf85e7f673"><div class="ttname"><a href="keyboard_8h.html#ad634625f3976f487d552cfbf85e7f673">META_ALT</a></div><div class="ttdeci">#define META_ALT</div><div class="ttdoc">Set while the alt key is pressed. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00025">keyboard.h:25</a></div></div>
<div class="ttc" id="keyboard_8h_html_a244e9bd68a241e2eec1bcefe3f044c08"><div class="ttname"><a href="keyboard_8h.html#a244e9bd68a241e2eec1bcefe3f044c08">META_ESCAPED</a></div><div class="ttdeci">#define META_ESCAPED</div><div class="ttdoc">Set if key&amp;#39;s scan code is escaped. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00026">keyboard.h:26</a></div></div>
<div class="ttc" id="keyboard_8h_html_a72c2f699b3146f912507ee67d7ab0e8d"><div class="ttname"><a href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8d">keycode</a></div><div class="ttdeci">keycode</div><div class="ttdoc">Key code values representing individual keys on the keyboard. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00038">keyboard.h:38</a></div></div>
<div class="ttc" id="keyboard_8c_html_a4c1f46e65d432e8e212bfbd2593b65c2"><div class="ttname"><a href="keyboard_8c.html#a4c1f46e65d432e8e212bfbd2593b65c2">state</a></div><div class="ttdeci">static kbstate_t state</div><div class="ttdoc">Current keyboard state. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00121">keyboard.c:121</a></div></div>
<div class="ttc" id="keyboard_8c_html_ae4c7324a15a4e830cdb0f64b47492a78"><div class="ttname"><a href="keyboard_8c.html#ae4c7324a15a4e830cdb0f64b47492a78">kbstate::buf_tail</a></div><div class="ttdeci">uint8_t buf_tail</div><div class="ttdoc">Index of next empty slot in buf. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00113">keyboard.c:113</a></div></div>
<div class="ttc" id="keyboard_8c_html_a746a5dc770f29d218377bf82d53a405d"><div class="ttname"><a href="keyboard_8c.html#a746a5dc770f29d218377bf82d53a405d">F_8</a></div><div class="ttdeci">#define F_8</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00054">keyboard.c:54</a></div></div>
<div class="ttc" id="keyboard_8c_html_af0d28d590ed60c797d6caec15ceccdd0"><div class="ttname"><a href="keyboard_8c.html#af0d28d590ed60c797d6caec15ceccdd0">F_2</a></div><div class="ttdeci">#define F_2</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00048">keyboard.c:48</a></div></div>
<div class="ttc" id="keyboard_8c_html_a75d086fb1bfdedee4b3084000b7340aa"><div class="ttname"><a href="keyboard_8c.html#a75d086fb1bfdedee4b3084000b7340aa">KB_PORT_DATA</a></div><div class="ttdeci">#define KB_PORT_DATA</div><div class="ttdoc">Keyboard I/O data port. </div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00017">keyboard.c:17</a></div></div>
<div class="ttc" id="keyboard_8c_html_a5d31dc96753cf56b7242a24a6ce84952"><div class="ttname"><a href="keyboard_8c.html#a5d31dc96753cf56b7242a24a6ce84952">KDN</a></div><div class="ttdeci">#define KDN</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00036">keyboard.c:36</a></div></div>
<div class="ttc" id="keyboard_8h_html_structkey"><div class="ttname"><a href="keyboard_8h.html#structkey">key</a></div><div class="ttdoc">A record representing the state of the keyboard at the time a key was presssed or unpressed...</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00087">keyboard.h:87</a></div></div>
<div class="ttc" id="keyboard_8c_html_acfe552a3625b01348ebdde65192f69f0"><div class="ttname"><a href="keyboard_8c.html#acfe552a3625b01348ebdde65192f69f0">KPL</a></div><div class="ttdeci">#define KPL</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00046">keyboard.c:46</a></div></div>
<div class="ttc" id="keyboard_8c_html_ab380112d877adff3c3ccc7877a01be36"><div class="ttname"><a href="keyboard_8c.html#ab380112d877adff3c3ccc7877a01be36">SES</a></div><div class="ttdeci">#define SES</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00059">keyboard.c:59</a></div></div>
<div class="ttc" id="keyboard_8c_html_a9b88d338f018c2e5801f9b179fed5c88"><div class="ttname"><a href="keyboard_8c.html#a9b88d338f018c2e5801f9b179fed5c88">APO</a></div><div class="ttdeci">#define APO</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00061">keyboard.c:61</a></div></div>
<div class="ttc" id="keyboard_8h_html_a72c2f699b3146f912507ee67d7ab0e8daeb0b14cf15c6baf4ba90bc84bc84e7d3"><div class="ttname"><a href="keyboard_8h.html#a72c2f699b3146f912507ee67d7ab0e8daeb0b14cf15c6baf4ba90bc84bc84e7d3">KEY_CAPSLOCK</a></div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8h_source.html#l00048">keyboard.h:48</a></div></div>
<div class="ttc" id="keyboard_8c_html_adc62e34d3d434791472398628ae91f16"><div class="ttname"><a href="keyboard_8c.html#adc62e34d3d434791472398628ae91f16">F_5</a></div><div class="ttdeci">#define F_5</div><div class="ttdef"><b>Definition:</b> <a href="keyboard_8c_source.html#l00051">keyboard.c:51</a></div></div>
<div class="ttc" id="string_8h_html_a37562939be846210ce0560a6168cd7f1"><div class="ttname"><a href="string_8h.html#a37562939be846210ce0560a6168cd7f1">memcpy</a></div><div class="ttdeci">void * memcpy(void *dst, const void *src, size_t num)</div><div class="ttdoc">Copy bytes from one memory region to another. </div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_dc43877d82dd332f9fb2071fcca799d6.html">kernel</a></li><li class="navelem"><a class="el" href="dir_4dc1b7c9c515ea8439ed34903c24ff05.html">device</a></li><li class="navelem"><a class="el" href="keyboard_8c.html">keyboard.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.12 </li>
  </ul>
</div>
</body>
</html>
